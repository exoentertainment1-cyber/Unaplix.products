<!DOCTYPE html>
<html>
<head>
<title>Product Details</title>
<style>
body{font-family:Arial;background:#f4f6f8;padding:40px;}
.container{background:#fff;padding:30px;border-radius:10px;max-width:500px;margin:auto;box-shadow:0 5px 15px rgba(0,0,0,0.1);}
button{background:#22c55e;color:#fff;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;margin-top:15px;}
input{width:100%;padding:8px;margin:8px 0;}
</style>
</head>
<body>

<div class="container">
    <h2 id="name"></h2>
    <p id="desc"></p>
    <h3 id="price"></h3>

    <h4>Cash on Delivery Only</h4>

    <input type="text" id="customerName" placeholder="Enter Your Name">
    <input type="text" id="address" placeholder="Enter Your Address">
    <input type="text" id="phone" placeholder="Enter Phone Number">

    <button id="buyBtn">Buy Now</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDFrySE90eGW4KKTH0xRCVwdb97EQOY8NE",
  authDomain: "unaplix-products.firebaseapp.com",
  projectId: "unaplix-products",
  storageBucket: "unaplix-products.firebasestorage.app",
  messagingSenderId: "576487097704",
  appId: "1:576487097704:web:ee308d4bd0552034dfc2dd"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Get selected product safely
const product = JSON.parse(localStorage.getItem("selectedProduct"));

if (!product) {
  alert("No product selected. Please select product again.");
  window.location.href = "index.html";
} else {
  document.getElementById("name").innerText = product.name;
  document.getElementById("desc").innerText = product.desc;
  document.getElementById("price").innerText = "Price: â‚¹" + product.price;
}

// Button click event
document.getElementById("buyBtn").addEventListener("click", async () => {

  const customer = document.getElementById("customerName").value;
  const address = document.getElementById("address").value;
  const phone = document.getElementById("phone").value;

  if (!customer || !address || !phone) {
    alert("Please fill all details");
    return;
  }

  const order = {
    product: product.name,
    price: product.price,
    customer: customer,
    address: address,
    phone: phone,
    payment: "Cash on Delivery",
    status: "Pending",
    createdAt: new Date()
  };

  try {
    await addDoc(collection(db, "orders"), order);
    alert("Order Placed Successfully!");
    window.location.href = "index.html";
  } catch (error) {
    alert("Error placing order. Check Firestore rules.");
    console.log(error);
  }

});

</script>

</body>
</html>
